{% extends "base.html" %}

{% block title %}Viewing {{ path | replace("_", " ") }}{% endblock %}

{% block content %}
<script>
  window.noteFilename = "{{ path }}";
</script>


<b><b>Viewing: {{ display_title }}</b></b>

<form method="post" action="/save-note/{{ path }}">
    <div class="toolbar">
        <button type="submit">ğŸ’¾ Save</button>

        <!--<label for="destination_folder">Move:</label>
        <select id="destination_folder" name="destination_folder">
            {% for folder in folders %}
                <option value="{{ folder }}">{{ folder }}</option>
            {% endfor %}
        </select>
        <button type="button" onclick="submitMove()">ğŸ“‚ Move</button>-->

        <span style="margin-left: 20px;">
            <button type="button" id="toggle-editor">ğŸ“ Toggle Edit</button>
            <button type="button" id="toggle-preview">ğŸ‘ï¸ Toggle Preview</button>
        </span>
    </div>

    <div class="editor-container">
        <div id="editor" class="editor-section">
            <textarea id="content" name="content" required>{{ note_content }}</textarea>
        </div>
        <div id="preview" class="preview-section"></div>
    </div>
</form>

<!-- New Move form -->
<form id="moveForm" method="post" action="/move-note/{{ username }}/{{ path }}" style="margin-top: 1em;">
    <label for="destination_folder">Move:</label>
    <select id="destination_folder" name="destination_folder">
        {% for folder in folders %}
            <option value="{{ folder }}">{{ folder }}</option>
        {% endfor %}
    </select>
    <button type="submit">ğŸ“‚ Move</button>
</form>

<!-- Delete form -->
<form id="delete-form" method="post" action="/delete-note/{{ path }}"></form>

<!-- Delete button -->
<button type="button" onclick="confirmDelete()">ğŸ—‘ï¸ Delete</button>

<script>
function confirmDelete() {
    if (confirm("Are you sure you want to delete this note?")) {
        document.getElementById("delete-form").submit();
    }
}
</script>


<!-- Autosave indicator -->
<div id="save-status" class="save-status">ğŸ’¾ Saved</div>


<script>
function confirmDelete() {
    if (confirm("Delete this note?")) {
        document.getElementById('delete-form').submit();
    }
}

function submitMove() {
    const selectedFolder = document.getElementById('destination_folder').value;
    document.getElementById('hidden-destination-folder').value = selectedFolder;
    document.getElementById('move-form').submit();
}
</script>

<script src="/static/js/marked.min.js"></script>
<script src="/static/js/edit_note.js"></script>
{% endblock %}
